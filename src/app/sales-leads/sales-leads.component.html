<!-- src/app/sales-leads/sales-leads.component.html (Updated with full lead details modal) -->
<div class="sales-leads-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>My Leads</h1>
      <p>Manage your assigned leads and track progress</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="loadLeads()">
        <i class="fas fa-sync-alt"></i>
        <span>Refresh</span>
      </button>
      <button class="btn-primary" (click)="createNewLead()">
        <i class="fas fa-plus"></i>
        <span>Add Lead</span>
      </button>
    </div>
  </div>

  <!-- Quick Stats Cards -->
  <div class="stats-row">
    <div class="stat-card stat-created">
      <div class="stat-icon">
        <i class="fas fa-user-plus"></i>
      </div>
      <div class="stat-content">
        <h3>{{ totalCreatedLeads }}</h3>
        <p>Created by Me</p>
      </div>
    </div>

    <div class="stat-card stat-assigned">
      <div class="stat-icon">
        <i class="fas fa-user-check"></i>
      </div>
      <div class="stat-content">
        <h3>{{ totalAssignedLeads }}</h3>
        <p>Assigned to Me</p>
      </div>
    </div>

    <div class="stat-card stat-total">
      <div class="stat-icon">
        <i class="fas fa-users"></i>
      </div>
      <div class="stat-content">
        <h3>{{ displayedLeads.length }}</h3>
        <p>Displayed Leads</p>
      </div>
    </div>
  </div>

  <!-- Filters & Search Section -->
  <div class="filters-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Search by name, email, phone, company..." 
        [(ngModel)]="searchQuery"
        (input)="onSearchChange()"
      />
    </div>

    <div class="filter-controls">
      <select [(ngModel)]="selectedStatus" (change)="onStatusFilterChange()" class="filter-select">
        <option value="all">All Status</option>
        <option value="New">New</option>
        <option value="Qualified">Qualified</option>
        <option value="Quoted">Quoted</option>
        <option value="Won">Won</option>
        <option value="Lost">Lost</option>
      </select>

      <select [(ngModel)]="selectedLeadType" (change)="onLeadTypeChange()" class="filter-select my-leads-filter">
        <option value="created">Created Leads</option>
        <option value="assigned">Assigned Leads</option>
      </select>

      <button class="btn-clear-filter" (click)="clearFilters()" *ngIf="searchQuery || selectedStatus !== 'all'">
        <i class="fas fa-times"></i>
        <span>Clear Filters</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Loading leads...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="error-state">
    <i class="fas fa-exclamation-circle"></i>
    <p>{{ errorMessage }}</p>
    <button class="btn-secondary" (click)="loadLeads()">Try Again</button>
  </div>

  <!-- Table View -->
  <div *ngIf="!isLoading && !errorMessage" class="table-card">
    <div class="table-header">
      <h3>
        <i class="fas fa-list"></i>
        {{ selectedLeadType === 'created' ? 'Created Leads' : 'Assigned Leads' }}
        <span class="count-badge">{{ displayedLeads.length }}</span>
      </h3>
    </div>

    <div class="table-container">
      <table class="leads-table">
        <thead>
          <tr>
            <th>Name & Company</th>
            <th>Contact</th>
            <th>Source</th>
            <th class="col-actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let lead of paginatedLeads" class="table-row" (click)="viewLeadModal(lead)">
            <td>
              <div class="lead-info-cell">
                <div class="lead-avatar">
                  <i class="fas fa-user-circle"></i>
                </div>
                <div>
                  <strong class="lead-name">{{ lead.fullName }}</strong>
                  <div class="lead-company">{{ lead.companyName || 'N/A' }}</div>
                </div>
              </div>
            </td>
            <td>
              <div class="contact-cell">
                <div><i class="fas fa-envelope"></i> {{ lead.email }}</div>
                <div class="text-muted"><i class="fas fa-phone"></i> {{ lead.phoneNumber }}</div>
              </div>
            </td>
            <td>
              <span class="source-badge">{{ lead.leadSource }}</span>
            </td>
            <td class="col-actions">
              <div class="action-buttons">
                <button class="action-btn btn-view" (click)="viewLeadModal(lead); $event.stopPropagation()" title="View Details">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="action-btn btn-edit" (click)="editLead(lead, $event)" title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn btn-delete" (click)="deleteLead(lead, $event)" title="Delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div *ngIf="displayedLeads.length === 0 && !isLoading" class="empty-state">
        <i class="fas fa-inbox"></i>
        <h3>No leads found</h3>
        <p *ngIf="selectedLeadType === 'created'">You haven't created any leads yet</p>
        <p *ngIf="selectedLeadType === 'assigned'">No leads have been assigned to you yet</p>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-controls" *ngIf="displayedLeads.length > 0">
      <button class="pagination-btn" (click)="prevPage()" [disabled]="currentPage === 1">
        <i class="fas fa-chevron-left"></i>
      </button>
      <span class="page-info">Page {{currentPage}} of {{totalPages}}</span>
      <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage >= totalPages">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<!-- Enhanced View Lead Modal with All Details -->
<div *ngIf="showViewModal && selectedLead" class="modal-overlay" (click)="closeViewModal()">
  <div class="modal-content modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <i class="fas fa-user-circle"></i>
        Lead Details
      </h2>
      <button class="modal-close" (click)="closeViewModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body modal-scrollable">
      <!-- Lead Header -->
      <div class="detail-section header-section">
        <div class="lead-avatar-large">
          <i class="fas fa-user-circle"></i>
        </div>
        <div class="lead-main-info">
          <h3>{{ selectedLead.fullName }}</h3>
          <p class="company-name">{{ selectedLead.companyName || 'N/A' }}</p>
          <div class="badges-row">
            <span class="status-badge" [ngClass]="getStatusClass(selectedLead.status)">
              <i class="fas" [ngClass]="getStatusIcon(selectedLead.status)"></i>
              {{ selectedLead.status }}
            </span>
            <span class="source-badge">
              <i class="fas fa-tag"></i>
              {{ selectedLead.leadSource }}
            </span>
            <span class="priority-badge" [ngClass]="getPriorityClass(getPriority())">
              <i class="fas" [ngClass]="getPriorityIcon(getPriority())"></i>
              {{ getPriority() | titlecase }} Priority
            </span>
          </div>
        </div>
      </div>

      <!-- Basic Information -->
      <div class="detail-section">
        <h4><i class="fas fa-info-circle"></i> Basic Information</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label><i class="fas fa-user"></i> Full Name</label>
            <p>{{ selectedLead.fullName }}</p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-building"></i> Company Name</label>
            <p>{{ selectedLead.companyName || 'N/A' }}</p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-id-badge"></i> Designation</label>
            <p>{{ getDesignation() }}</p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-tag"></i> Lead Source</label>
            <p><span class="source-badge">{{ selectedLead.leadSource }}</span></p>
          </div>
        </div>
      </div>

      <!-- Contact Details -->
      <div class="detail-section">
        <h4><i class="fas fa-address-card"></i> Contact Details</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label><i class="fas fa-envelope"></i> Email Address</label>
            <p><a [href]="'mailto:' + selectedLead.email">{{ selectedLead.email }}</a></p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-phone"></i> Primary Phone</label>
            <p><a [href]="'tel:' + selectedLead.phoneNumber">{{ selectedLead.phoneNumber }}</a></p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-phone-alt"></i> Alternate Phone</label>
            <p>{{ getAlternatePhone() }}</p>
          </div>
          <div class="detail-item full-width">
            <label><i class="fas fa-map-marker-alt"></i> Address</label>
            <p>{{ getAddress() }}</p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-city"></i> City</label>
            <p>{{ getCity() }}</p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-map"></i> State</label>
            <p>{{ getState() }}</p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-map-pin"></i> Pincode</label>
            <p>{{ getPincode() }}</p>
          </div>
        </div>
      </div>

      <!-- Requirements & Budget -->
      <div class="detail-section">
        <h4><i class="fas fa-clipboard-list"></i> Requirements & Budget</h4>
        <div class="detail-grid">
          <div class="detail-item full-width">
            <label><i class="fas fa-shopping-cart"></i> Product/Service Interest</label>
            <p>{{ getProductInterest() }}</p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-rupee-sign"></i> Estimated Budget</label>
            <p class="budget-value">{{ getBudget() }}</p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-calendar-alt"></i> Purchase Timeline</label>
            <p>{{ getTimeline() }}</p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-boxes"></i> Quantity</label>
            <p>{{ getQuantity() }}</p>
          </div>
        </div>
      </div>

      <!-- Lead Status Information -->
      <div class="detail-section">
        <h4><i class="fas fa-chart-line"></i> Lead Status Information</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <label><i class="fas fa-signal"></i> Current Status</label>
            <p>
              <span class="status-badge" [ngClass]="getStatusClass(selectedLead.status)">
                <i class="fas" [ngClass]="getStatusIcon(selectedLead.status)"></i>
                {{ selectedLead.status }}
              </span>
            </p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-calendar-plus"></i> Created Date</label>
            <p>{{ formatDate(selectedLead.createdAt) }}</p>
          </div>
          <div class="detail-item">
            <label><i class="fas fa-calendar-check"></i> Last Updated</label>
            <p>{{ formatDate(selectedLead.updatedAt) }}</p>
          </div>
        </div>
      </div>

      <!-- Additional Notes (if any leftover notes exist) -->
      <div class="detail-section" *ngIf="selectedLead.notes && selectedLead.notes.length > 0">
        <h4><i class="fas fa-sticky-note"></i> Additional Notes</h4>
        <div class="notes-display">
          <p>{{ selectedLead.notes }}</p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeViewModal()">
        <i class="fas fa-times"></i>
        Close
      </button>
      <button class="btn-primary" (click)="editLead(selectedLead._id, $event); closeViewModal()">
        <i class="fas fa-edit"></i>
        Edit Lead
      </button>
    </div>
  </div>
</div>