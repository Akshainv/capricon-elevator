<!-- src/app/features/leads/sales-import-leads/sales-import-leads.component.html -->
<div class="import-leads-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>Import Leads</h1>
      <p>Upload CSV file to bulk import leads</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="downloadTemplate()">
        <i class="fas fa-download"></i>
        <span>Download Template</span>
      </button>
      <button class="btn-cancel" (click)="goToLeads()">
        <i class="fas fa-times"></i>
        <span>Cancel</span>
      </button>
    </div>
  </div>

  <!-- Import Section -->
  <div *ngIf="!showImportResult" class="import-section">
    <div class="upload-card">
      <h2 class="section-title">
        <i class="fas fa-cloud-upload-alt"></i>
        Upload CSV File
      </h2>

      <!-- File Upload Area -->
      <div *ngIf="!selectedFile" class="upload-area">
        <input 
          #fileInput
          type="file" 
          id="fileInput" 
          accept=".csv,.xlsx,.xls"
          (change)="onFileSelect($event)"
          style="display: none;"
        />
        <div class="upload-label" (click)="fileInput.click()">
          <i class="fas fa-file-excel upload-icon"></i>
          <h3>Click to upload or drag and drop</h3>
          <p>Supported formats: CSV, Excel (.xlsx, .xls)</p>
          <p class="file-limit">Maximum file size: 5MB</p>
          <button type="button" class="btn-upload" (click)="$event.stopPropagation(); fileInput.click()">
            <i class="fas fa-folder-open"></i>
            Browse Files
          </button>
        </div>
      </div>

      <!-- Selected File Info -->
      <div *ngIf="selectedFile && !isProcessing" class="file-selected">
        <div class="file-info">
          <i class="fas fa-file-csv file-icon"></i>
          <div class="file-details">
            <h4>{{ selectedFile.name }}</h4>
            <p>{{ formatFileSize(selectedFile.size) }} â€¢ {{ fullData.length }} rows</p>
          </div>
          <button class="btn-remove" (click)="removeFile()" title="Remove file">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>

      <!-- Processing Indicator -->
      <div *ngIf="isProcessing" class="processing-indicator">
        <i class="fas fa-spinner fa-spin"></i>
        <span>Processing file...</span>
      </div>

      <!-- Data Preview -->
      <div *ngIf="selectedFile && !isProcessing && previewData.length > 0" class="preview-section">
        <h3><i class="fas fa-eye"></i> Data Preview (First 10 Rows)</h3>
        <div class="preview-info">
          <p><strong>Total Rows:</strong> {{ fullData.length }}</p>
          <p><strong>Columns:</strong> {{ fileColumns.length }}</p>
        </div>
        <div class="preview-table-container">
          <table class="preview-table">
            <thead>
              <tr>
                <th>#</th>
                <th *ngFor="let col of fileColumns">{{ col }}</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of previewData; let i = index">
                <td class="row-number">{{ i + 1 }}</td>
                <td *ngFor="let col of fileColumns">
                  {{ row[col] || '-' }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Import Button -->
      <div *ngIf="selectedFile && !isProcessing" class="import-action">
        <button 
          class="btn-import" 
          (click)="importLeads()"
          [disabled]="isImporting"
        >
          <i class="fas" [ngClass]="isImporting ? 'fa-spinner fa-spin' : 'fa-upload'"></i>
          {{ isImporting ? 'Importing...' : 'Import Leads' }}
        </button>
      </div>

      <!-- Upload Instructions -->
      <div class="upload-instructions">
        <h3><i class="fas fa-info-circle"></i> Instructions</h3>
        <ul>
          <li>Ensure your CSV file contains a header row with column names</li>
          <li>Required columns may include: Name, Email, Phone Number</li>
          <li>Use the template file for reference on formatting</li>
          <li>Remove any special characters or formulas from the data</li>
          <li>Maximum 1000 records per import</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Import Result -->
  <div *ngIf="showImportResult && importResult" class="result-section">
    <div class="result-card">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      
      <h2 class="section-title">Import Complete!</h2>

      <div class="result-stats">
        <div class="stat-box stat-total">
          <div class="stat-icon">
            <i class="fas fa-file-alt"></i>
          </div>
          <div class="stat-info">
            <h3>{{ importResult.totalRows }}</h3>
            <p>Total Records</p>
          </div>
        </div>

        <div class="stat-box stat-success">
          <div class="stat-icon">
            <i class="fas fa-check"></i>
          </div>
          <div class="stat-info">
            <h3>{{ importResult.successfulImports }}</h3>
            <p>Successfully Imported</p>
          </div>
        </div>

        <div class="stat-box stat-failed">
          <div class="stat-icon">
            <i class="fas fa-times"></i>
          </div>
          <div class="stat-info">
            <h3>{{ importResult.failedImports }}</h3>
            <p>Failed</p>
          </div>
        </div>
      </div>

      <!-- Error List -->
      <div *ngIf="importResult.errors.length > 0" class="error-section">
        <h3><i class="fas fa-exclamation-triangle"></i> Errors ({{ importResult.errors.length }})</h3>
        <div class="error-list">
          <div *ngFor="let error of importResult.errors.slice(0, 10)" class="error-item">
            {{ error }}
          </div>
          <p *ngIf="importResult.errors.length > 10" class="more-errors">
            ... and {{ importResult.errors.length - 10 }} more errors
          </p>
        </div>
      </div>

      <div class="result-actions">
        <button class="btn-secondary" (click)="startNewImport()">
          <i class="fas fa-plus"></i>
          Import More Leads
        </button>
        <button class="btn-primary" (click)="goToLeads()">
          <i class="fas fa-list"></i>
          View All Leads
        </button>
      </div>
    </div>
  </div>
</div>