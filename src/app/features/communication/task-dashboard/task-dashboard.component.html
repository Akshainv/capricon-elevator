<div class="task-assignment-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <div class="header-title">
        <h1>Assign Task to Employee</h1>
        <p>Create and assign tasks to team members with projects</p>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="cancel()">
        <i class="fas fa-times"></i>
        <span>Cancel</span>
      </button>
    </div>
  </div>

  <!-- Task Assignment Form -->
  <div class="form-layout">
    <div class="form-column">
      
      <!-- Employee Selection Card -->
      <div class="form-card employee-card">
        <div class="card-header">
          <h3><i class="fas fa-user-tie"></i> Select Employee</h3>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label>Search Employee <span class="required">*</span></label>
            
            <div class="search-container">
              <div class="search-input-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input 
                  type="text"
                  [(ngModel)]="employeeSearchTerm"
                  (input)="onEmployeeSearch()"
                  (focus)="onEmployeeSearchFocus()"
                  (blur)="onEmployeeSearchBlur()"
                  placeholder="Search by name, email, department, or role..."
                  class="form-input search-input"
                  autocomplete="off"
                />
                <button 
                  *ngIf="employeeSearchTerm"
                  class="clear-search-btn"
                  (mousedown)="$event.preventDefault()"
                  (click)="clearEmployeeSearch()"
                  type="button"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <!-- Employee Dropdown -->
              <div *ngIf="showEmployeeDropdown && filteredEmployees.length > 0" class="search-dropdown">
                <div class="dropdown-header">
                  <span>{{ filteredEmployees.length }} employee(s) found</span>
                </div>
                <div class="dropdown-results">
                  <div 
                    *ngFor="let employee of filteredEmployees"
                    class="dropdown-item"
                    (mousedown)="$event.preventDefault(); selectEmployee(employee)"
                  >
                    <div class="item-main">
                      <i class="fas fa-user-circle item-avatar-icon"></i>
                      <div class="item-info">
                        <div class="item-name">{{ employee.name }}</div>
                        <div class="item-subtitle">{{ employee.role }} - {{ employee.department }}</div>
                      </div>
                    </div>
                    <div class="item-detail">
                      <i class="fas fa-envelope"></i>
                      {{ employee.email }}
                    </div>
                  </div>
                </div>
              </div>

              <!-- No Results -->
              <div *ngIf="showEmployeeDropdown && filteredEmployees.length === 0 && employeeSearchTerm" class="no-results-message">
                <i class="fas fa-search"></i>
                No employees found matching "{{ employeeSearchTerm }}"
              </div>
            </div>

            <!-- Selected Employee Display -->
            <div *ngIf="selectedEmployee" class="selected-display">
              <div class="selected-info">
                <i class="fas fa-user-check"></i>
                <div>
                  <strong>{{ selectedEmployee.name }}</strong>
                  <span>{{ selectedEmployee.role }} - {{ selectedEmployee.department }}</span>
                </div>
              </div>
            </div>

            <p *ngIf="!employeeSearchTerm && !selectedEmployee" class="helper-text">
              <i class="fas fa-info-circle"></i>
              Start typing to search for an employee to assign this task.
            </p>
          </div>
        </div>
      </div>

      <!-- Project Selection Card (Optional) -->
      <div class="form-card project-card">
        <div class="card-header">
          <h3><i class="fas fa-project-diagram"></i> Select Project (Optional)</h3>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label>Search Project</label>
            
            <div class="search-container">
              <div class="search-input-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input 
                  type="text"
                  [(ngModel)]="projectSearchTerm"
                  (input)="onProjectSearch()"
                  (focus)="onProjectSearchFocus()"
                  (blur)="onProjectSearchBlur()"
                  placeholder="Search by project name, client, or ID..."
                  class="form-input search-input"
                  autocomplete="off"
                />
                <button 
                  *ngIf="projectSearchTerm"
                  class="clear-search-btn"
                  (mousedown)="$event.preventDefault()"
                  (click)="clearProjectSearch()"
                  type="button"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <!-- Project Dropdown -->
              <div *ngIf="showProjectDropdown && filteredProjects.length > 0" class="search-dropdown">
                <div class="dropdown-header">
                  <span>{{ filteredProjects.length }} project(s) found</span>
                </div>
                <div class="dropdown-results">
                  <div 
                    *ngFor="let project of filteredProjects"
                    class="dropdown-item"
                    (mousedown)="$event.preventDefault(); selectProject(project)"
                  >
                    <div class="item-main">
                      <i class="fas fa-folder item-avatar-icon"></i>
                      <div class="item-info">
                        <div class="item-name">{{ project.name }}</div>
                        <div class="item-subtitle">{{ project.client }}</div>
                      </div>
                    </div>
                    <div class="item-detail">
                      <span class="status-badge" [ngClass]="'status-' + project.status.toLowerCase().replace(' ', '-')">
                        {{ project.status }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- No Results -->
              <div *ngIf="showProjectDropdown && filteredProjects.length === 0 && projectSearchTerm" class="no-results-message">
                <i class="fas fa-search"></i>
                No projects found matching "{{ projectSearchTerm }}"
              </div>
            </div>

            <!-- Selected Project Display -->
            <div *ngIf="selectedProject" class="selected-display">
              <div class="selected-info">
                <i class="fas fa-check-circle"></i>
                <div>
                  <strong>{{ selectedProject.name }}</strong>
                  <span>{{ selectedProject.client }}</span>
                </div>
              </div>
            </div>

            <p *ngIf="!projectSearchTerm && !selectedProject" class="helper-text">
              <i class="fas fa-info-circle"></i>
              Optionally link this task to a project for better organization.
            </p>
          </div>
        </div>
      </div>

      <!-- Simplified Task Details Card -->
      <div class="form-card">
        <div class="card-header">
          <h3><i class="fas fa-clipboard-list"></i> Task Description</h3>
        </div>
        <div class="card-body">
          <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
            
            <div class="form-group">
              <label>Describe the Task <span class="required">*</span></label>
              <textarea 
                formControlName="description"
                rows="8"
                placeholder="Enter a clear and detailed description of what needs to be done..."
                class="form-textarea"
              ></textarea>
            </div>

            <div class="form-actions">
              <button 
                type="submit" 
                class="btn-primary" 
                [disabled]="!taskForm.valid || !selectedEmployee || loading"
              >
                <i class="fas" [ngClass]="loading ? 'fa-spinner fa-spin' : 'fa-check'"></i>
                <span>{{ loading ? 'Assigning...' : 'Assign Task' }}</span>
              </button>
              
              <button type="button" class="btn-reset" (click)="resetForm()" [disabled]="loading">
                <i class="fas fa-redo"></i>
                <span>Reset Form</span>
              </button>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>