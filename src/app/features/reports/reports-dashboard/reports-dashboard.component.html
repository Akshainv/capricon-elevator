<!-- src/app/features/reports/reports-dashboard/reports-dashboard.component.html -->
<div class="reports-container">

  <!-- Loading Overlay -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="glass-loader">
      <div class="spinner"></div>
      <p>Fetching Intelligence...</p>
    </div>
  </div>

  <!-- Page Header (Locked Glassmorphism) -->
  <div class="dashboard-header glass">
    <div class="header-main">
      <div class="title-group">
        <h1>Report Dashboard</h1>
        <p class="subtitle">Performance Intelligence & Lifecycle Analytics</p>
      </div>

      <div class="header-controls">
        <!-- Searchable Employee Selector -->
        <div class="employee-selector">
          <div class="search-box" (click)="showEmployeeDropdown = !showEmployeeDropdown">
            <i class="fas fa-user-tie"></i>
            <input type="text" [(ngModel)]="employeeSearchQuery" (input)="filterEmployees()"
              placeholder="Select Sales Executive..." readonly>
            <i class="fas fa-chevron-down toggle-icon" [class.open]="showEmployeeDropdown"></i>
          </div>

          <div class="employee-dropdown glass-dropdown" *ngIf="showEmployeeDropdown">
            <div class="dropdown-item all-option" (click)="selectEmployee('all')">
              <i class="fas fa-globe"></i>
              <span>All Sales Executives</span>
            </div>
            <div *ngFor="let emp of filteredEmployees" class="dropdown-item" (click)="selectEmployee(emp)">
              <div class="emp-avatar">{{ emp.fullName.charAt(0) }}</div>
              <div class="emp-info">
                <span class="emp-name">{{ emp.fullName }}</span>
                <span class="emp-email">{{ emp.email }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Analysis Type Toggle -->
        <div class="analysis-toggle glass-toggle">
          <button [class.active]="analysisType === 'daily'" (click)="toggleAnalysisType('daily')">
            Daily Status
          </button>
          <button [class.active]="analysisType === 'monthly'" (click)="toggleAnalysisType('monthly')">
            Monthly Status
          </button>
          <button [class.active]="analysisType === 'total'" (click)="toggleAnalysisType('total')">
            Total Status
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard-content">
    <!-- KPI Analytics Cards -->
    <div class="stats-grid">
      <div *ngFor="let stat of statCards" class="stat-card glass-card h-hover">
        <div class="card-glow"
          [style.background]="'radial-gradient(circle at 50% 50%, ' + stat.color + '33, transparent 70%)'"></div>
        <div class="stat-icon" [style.color]="stat.color">
          <i class="fas" [ngClass]="stat.icon"></i>
        </div>
        <div class="stat-info">
          <span class="stat-label">{{ stat.label }}</span>
          <h2 class="stat-value" [style.color]="stat.color">{{ stat.value }}</h2>
          <p class="stat-subtitle">{{ stat.subtitle }}</p>
        </div>
      </div>
    </div>

    <!-- Employee Daily Performance Tracking (Conditional) -->
    <div class="employee-performance-section glass-card" *ngIf="analysisType === 'daily'">
      <div class="section-header">
        <div class="header-title">
          <i class="fas fa-users-cog pulse-icon"></i>
          <div>
            <h3>Employee Daily Performance</h3>
            <span class="subtitle">Real-time breakdown of today's activities across the sales team</span>
          </div>
        </div>
      </div>

      <div class="table-container glass-table">
        <table *ngIf="employeeDailyStats.length > 0; else noActivities">
          <thead>
            <tr>
              <th>Sales Executive</th>
              <th class="text-center">New Leads</th>
              <th class="text-center">Quotations</th>
              <th class="text-right">Realized Revenue</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let stat of employeeDailyStats" class="employee-row">
              <td>
                <div class="emp-cell">
                  <div class="emp-avatar">{{ stat.employeeName.charAt(0) }}</div>
                  <div class="emp-meta">
                    <span class="name">{{ stat.employeeName }}</span>
                    <span class="email">{{ stat.employeeEmail }}</span>
                  </div>
                </div>
              </td>
              <td class="text-center">
                <span class="badge" [class.has-value]="stat.leads > 0">{{ stat.leads }}</span>
              </td>
              <td class="text-center">
                <span class="badge" [class.has-value]="stat.quotations > 0">{{ stat.quotations }}</span>
              </td>
              <td class="text-right">
                <span class="revenue-value" [class.has-value]="stat.revenue > 0">
                  {{ stat.revenue > 0 ? formatCurrency(stat.revenue) : '₹0' }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>

        <ng-template #noActivities>
          <div class="empty-state">
            <i class="fas fa-calendar-day"></i>
            <p>No sales activity recorded for today yet.</p>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Performance Pulse Graph -->
    <div class="pulse-container glass-card">
      <div class="card-header">
        <div class="header-title">
          <i class="fas fa-wave-square pulse-icon"></i>
          <div>
            <h3>Performance Pulse</h3>
            <span class="subtitle">{{ analysisType === 'daily' ? 'Revenue trend analysis over the last 7 days' :
              'Revenue trend analysis over the last 6 months' }}</span>
          </div>
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="dot"></span>
            Realized Revenue (₹L)
          </div>
        </div>
      </div>

      <div class="chart-wrapper">
        <canvas baseChart #revenueChart [data]="revenueChartData" [options]="revenueChartOptions"
          [type]="revenueChartType">
        </canvas>
      </div>
    </div>
  </div>

  <!-- Perspective Backdrop Blur -->
  <div class="perspective-bg" *ngIf="showEmployeeDropdown" (click)="showEmployeeDropdown = false"></div>
</div>